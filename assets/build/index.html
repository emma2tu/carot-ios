<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blue Light Exposure Tracker</title>
</head>

<body>

  <div id="root"></div>

  <!-- ====================================== -->
<!--  BLUE LIGHT EXPOSURE CARD (Styled)    -->
<!-- ====================================== -->

<style>

  #bl-background {
  background: rgba(239, 243, 252, 1);
  width: 100vw !important;
  margin-left: calc(-50vw + 50%);
  padding: 2px 0 16px 0;
  }

  /* Card style matching screenshot */
  #bl-card {
    margin: 20px 16px;
    padding: 20px;
    border-radius: 22px;
    background: rgba(255, 255, 255, 0.92);
    border: 1px solid rgba(0,0,0,0.06);
    box-shadow: 0px 8px 20px rgba(0,0,0,0.06);
  }

  #bl-card-title {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    font-weight: 600;
    font-size: 18px;
    color: #333;
    margin-bottom: 4px;
  }

  #bl-card-subtitle {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 13px;
    color: #666;
    margin-bottom: 14px;
  }

  /* Styled dropdown */
  #bl-select {
    appearance: none;
    background: white;
    border: 1px solid #ccc;
    border-radius: 12px;
    padding: 8px 14px;
    font-size: 15px;
    color: #333;
    margin-bottom: 14px;
    width: 130px;
    box-shadow: 0px 2px 6px rgba(0,0,0,0.05);
  }

  /* Data Storage Tracking */

  #storage-card {
    background: #FFFFFF;
    border-radius: 22px;
    padding: 20px;
    margin: 24px 16px;
    border: 1px solid #E6E6E6;
    box-shadow: 0px 6px 18px rgba(0,0,0,0.06);
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  .storage-header {
    margin-bottom: 16px;
  }

  .storage-title {
    font-size: 18px;
    font-weight: 600;
    color: #333;
  }

  .storage-subtitle {
    font-size: 14px;
    color: #666;
    margin-top: 4px;
  }

  /* Two-box row */
  .storage-row {
    display: flex;
    justify-content: space-between;
    margin-top: 16px;
    margin-bottom: 20px;
  }

  .storage-box {
    background: #F7F9FF;
    flex: 1;
    padding: 16px;
    border-radius: 14px;
    border: 1px solid #EEF0FA;
    margin-right: 12px;
  }

  .storage-box:last-child {
    margin-right: 0;
  }

  .storage-label {
    font-size: 14px;
    color: #666;
    margin-bottom: 6px;
  }

  .storage-value {
    font-size: 16px;
    font-weight: 400;
    color: #222;
  }

  /* Sensor Reading Cards */
  .metrics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 24px 16px;
  }

  .metric-card {
    background: #FFFFFF;
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 20px;
    padding: 18px;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    box-shadow: 0px 6px 18px rgba(0,0,0,0.06);
  }

  .metric-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 15px;
    color: #555;
    margin-bottom: 10px;
    font-weight: 600;
  }

  .metric-icon {
    font-size: 18px;
    opacity: 0.85;
  }

  .metric-value {
    font-size: 16px;
    font-weight: 400;
    color: #222;
    margin-bottom: 20px;
    margin-top: 20px;
  }

  .metric-sub {
    font-size: 13px;
    color: #777;
}

#carot-header {
  display: flex;
  justify-content: space-between;
  align-items: center;

  height: 48px;                 /* matches standard iOS nav bar */
  padding: 0 14px;    
  background: #FFFFFF;

  border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.04);

  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 8px;
}

.carot-icon {
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.carot-icon svg {
  width: 100%;   /* actual icon size */
  height: 100%;
}

.carot-title {
  font-size: 16px;
  font-weight: 400;
  color: #222;
}

/* Right Bluetooth button */
#ble-button {
  
  width: 35px;
  height: 35px;
  border-radius: 12px;
  background: #FFFFFF;

  display: flex;
  align-items: center;
  justify-content: center;

  border: 1px solid rgba(0,0,0,0.1);
  box-shadow: 0px 4px 10px rgba(0,0,0,0.08);

  cursor: pointer;
}

.ble-icon {
  font-size: 20px;
  color: #333;
}


</style>


<!--  gui components    -->

<!--  carot header    -->
<div id="carot-header">
  <div class="header-left">
    <div class="carot-icon">
      <?xml version="1.0" encoding="UTF-8"?>
        <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 1024 1024">
          <!-- Generator: Adobe Illustrator 30.0.0, SVG Export Plug-In . SVG Version: 2.1.1 Build 123)  -->
          <defs>
            <style>
              .st0 {
                fill: #5ab7e4;
              }

              .st1 {
                fill: url(#linear-gradient2);
              }

              .st2 {
                fill: url(#linear-gradient1);
              }

              .st3 {
                fill: url(#linear-gradient3);
              }

              .st4 {
                fill: url(#linear-gradient4);
              }

              .st5 {
                fill: #addbf0;
              }

              .st6 {
                fill: #80c4e6;
              }

              .st7 {
                fill: #c9e3f0;
              }

              .st8 {
                fill: url(#linear-gradient);
              }

              .st9 {
                fill: #c5ccc8;
              }

              .st10 {
                fill: #3170ae;
              }

              .st11 {
                fill: #b8e2f4;
              }

              .st12 {
                fill: #8ad3ef;
              }

              .st13 {
                fill: #d8dcd7;
              }

              .st14 {
                fill: #4782bb;
              }

              .st15 {
                fill: #b0e1f4;
              }

              .st16 {
                fill: #89c4e3;
              }

              .st17 {
                fill: #99cee8;
              }

              .st18 {
                fill: #77a8d0;
              }

              .st19 {
                fill: #85d4f1;
              }

              .st20 {
                fill: #5eacd8;
              }

              .st21 {
                fill: #539fd2;
              }

              .st22 {
                fill: #ecf0f1;
              }

              .st23 {
                fill: #84b8dc;
              }

              .st24 {
                fill: #80bce0;
              }
            </style>
            <linearGradient id="linear-gradient" x1="456.22" y1="338.58" x2="446.84" y2="357.26" gradientTransform="translate(-940.89 -1505.46) rotate(12.06) scale(4.2 4.03)" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#2476b8"/>
              <stop offset="1" stop-color="#318ec8"/>
            </linearGradient>
            <linearGradient id="linear-gradient1" x1="445.91" y1="340.58" x2="426.15" y2="363.01" gradientTransform="translate(-940.89 -1505.46) rotate(12.06) scale(4.2 4.03)" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#4d9dd0"/>
              <stop offset="1" stop-color="#69bde4"/>
            </linearGradient>
            <linearGradient id="linear-gradient2" x1="377.53" y1="392.7" x2="445.97" y2="481.41" gradientTransform="translate(-940.89 -1505.46) rotate(12.06) scale(4.2 4.03)" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#64b1db"/>
              <stop offset="1" stop-color="#5481b6"/>
            </linearGradient>
            <linearGradient id="linear-gradient3" x1="403.47" y1="383.58" x2="454.29" y2="491.01" gradientTransform="translate(-940.89 -1505.46) rotate(12.06) scale(4.2 4.03)" gradientUnits="userSpaceOnUse">
              <stop offset=".05" stop-color="#4ab0dc"/>
              <stop offset=".42" stop-color="#3c93ca"/>
              <stop offset="1" stop-color="#3e6ba6"/>
            </linearGradient>
            <linearGradient id="linear-gradient4" x1="438.82" y1="379.11" x2="494.69" y2="468.57" gradientTransform="translate(-940.89 -1505.46) rotate(12.06) scale(4.2 4.03)" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#2f97cf"/>
              <stop offset=".17" stop-color="#1974b8"/>
              <stop offset="1" stop-color="#285494"/>
            </linearGradient>
          </defs>
          <g>
            <path class="st7" d="M409.79,216.45c-3.46.07-19.82-1.56-17.61,4.25-8.06-8.66-34-.16-45.32-7.68-4.48-66.38,80.45-53.86,125.37-54.34l-9.77,55.5-52.67,2.27Z"/>
            <path class="st16" d="M581.74,159.03c14.4,17.21,24.08,37.77,39.7,53.55.89.9,2.08,1.91,1.38,3.3-.95,0-1.25.53-2.2.53-36.85-.13-73.66-.8-110.51-.57-.33,0-.67-.22-1-.21l.68-56.94c23.97.05,47.96-.15,71.94.34Z"/>
            <path class="st8" d="M634.5,278.47c-9.53,15.37-20.05,30.35-29.6,45.75-1.64,2.64-3.27,5.3-4.84,7.98-4.16-1.45-26.09.15-32.37.1l52.93-115.88c.95,0,1.25-.54,2.2-.53,14.9.06,30.8,1.21,45.17-1.37-2,17.64-23.38,47.65-33.49,63.95Z"/>
            <path class="st17" d="M392.18,220.7l56.6,111.24c-5.88.04-27.79-1.41-31.17-.65-10.17-17.48-21.78-34.18-32.92-51.1-10.71-16.27-36.63-49.33-37.84-67.17,11.32,7.51,37.27-.99,45.32,7.68Z"/>
            <path class="st11" d="M509.8,158.69l-.68,56.94c-34.08.22-64.12.15-99.32.82l52.67-2.27,9.77-55.5c12.46-.13,25.1-.01,37.57.01Z"/>
            <path class="st18" d="M667.99,214.51c-14.37,2.58-30.27,1.43-45.17,1.37.7-1.39-.49-2.4-1.38-3.3l9.84-50.98c21.64,6.9,39.22,30.82,36.71,52.91Z"/>
            <path class="st23" d="M631.28,161.6l-9.84,50.98c-15.63-15.77-25.3-36.34-39.7-53.55,16.21.33,33.66-2.5,49.55,2.57Z"/>
            <path class="st5" d="M510.11,215.84l1.22,116.43c-20.83-.1-41.73-.49-62.55-.34l-56.6-111.24c-2.21-5.81,14.15-4.19,17.61-4.25,35.2-.67,65.24-.6,99.32-.82.33,0,.67.22,1,.21Z"/>
            <path class="st2" d="M620.62,216.41l-52.93,115.88c-18.77-.16-37.58.07-56.35-.02l-1.22-116.43c36.85-.23,73.65.44,110.51.57Z"/>
            <g>
              <path class="st22" d="M600.06,332.2c3.37,1.17,1.9,1.63,2.38,3.51.58,2.25-.79,5.42.56,7.13-.18.02-.11,2.71-1.11,2.77-62.23-3.13-125.06.83-186.84-2.35l.15-10.48c.33-1.1,1.42-1.27,2.41-1.49,3.38-.76,25.29.69,31.17.65,20.82-.15,41.72.24,62.55.34,18.77.09,37.58-.14,56.35.02,6.29.06,28.22-1.54,32.37-.1Z"/>
              <path class="st13" d="M413.42,331.39c-.1,8.6,3.55,16.6-8.26,14.26-6.66-5.55-3.59-15.87,8.26-14.26Z"/>
              <path class="st9" d="M603.01,342.84c-1.36-1.71.01-4.88-.56-7.13,4.07-6.07,12.92-5.43,13.08,2.29.22,10.78-7.97,4.45-12.51,4.84Z"/>
            </g>
          </g>
          <g>
            <path class="st1" d="M328.23,366.37c-1.07,2-2.75,2.79-1.23,5.75l.47,5.11-3.17-4.68-42.76-.12c-1.89.47.37,9.18.55,9.63,1.54,3.93,7.66,12.11,9.91,17.14,64.61,144.49,136.86,285.5,187.79,435.2l1.28,3.78-3.6-.27-18.82-12.03c-2.83-2.55-5.5-5.15-8.25-7.77-58.55-117.22-110.97-237.98-165.29-357.29-8.89-19.53-26.52-46.31-30.75-66.16-1.45-6.79-1.63-16.31-1.28-23.31,2.57-2.83,6.47.61,8.91-2.6,2.25-2.97-1.75-6.09,1.24-8.25.61,7.27,1.14,6.82,8.75,7.88,3.61.5,48.76.72,51.16-.09.76-.26,3.22-3.09,3.31-3.3l1.79,1.38Z"/>
            <path class="st10" d="M575.73,829.85c-34.29,27.8-83.48,26.31-117.08-3.98l18.82,12.03,3.6.27-1.28-3.78c5.15,9.19,13.07,3.91,20.46,4.37.37.02,3.88,3.2,6.58,3.41,1.24.1,5.19-4.05,8.39-.21l2.72-5.43c1.97,1.01-.56,3.59.47,5.11,1.77,2.61,35.93,1.84,37.99-4.4l61.88-187.08,127.76-275.66c2.74.13,15.2-.78,16.48,1.02-.82,1.83.71,4.63.77,6.17.47,11.67-13.49,42.5-18.85,54.06-1.2,2.58-7.35,7.18-8.44,10.21-.62,1.72,2.8,2.65,2.38,3.51-.91,1.88-7.97,9.17-8.44,10.21-.44.98.26,8.39-1.25,10.75-1.98,3.08-8.02,5.05-9.44,10-.38,1.32,2.45,3.32,2.38,3.51-.72,2.01-5.39,7.37-6.04,8.73-.15.31-.19,6.47-.43,6.92-.57,1.04-7.72,5.03-9.03,8.09-1.2,2.79.07,9.49-.05,10-.08.36-2.34,1.14-2.41,1.49-.05.28,2.11,5.18,1.97,5.43-.83,1.44-5.62,2.51-5.81,2.77-1.39,1.89-5.44,6.37-5.63,6.81-.32.75-.22,11.37-.46,11.92-1.3,2.95-6.33,2.64-6.83,7.55-.17,1.66,2.42,3.31,2.38,3.51-.11.63-6.24,2.94-8.24,9.26-1.18,3.73,1.24,10.76.54,12.13-.38.74-4.27,2.13-4.81,2.98-.96,1.5-2.61,6.29-3.84,8.19-.65,1-5.56,2.85-6.01,3.72-.29.56,2.07.82,1.79,1.38-3.92,7.92-3.15,13.57-4.89,17.98-.11.29-4.9,3.64-5.02,3.94-.94,2.33.52,7.72.36,8.09-1.07,2.45-12.05,16.39-12.08,17.45-.02.81,3.71,2.73,2.97,5.64-.31,1.21-5.47,3.93-6.42,5.64-.85,1.53.92,3.71-.23,5.96-.23.46-4.74,3.44-5.02,3.94-.92,1.67.03,6.03-.43,6.92-4.58,8.72-8.97,7.76-12.1,22.45-.07.35-2.37,1.17-2.41,1.49-.21,1.77,4.32,3.66,4.38,3.94.17.89-12.07,11.94-12.26,13.41-.42,3.29,10.74,6.06,5.33,14.16-.79,1.18-5.14,2.51-6.22,4.68-.29.57-1.13,11.73-1.66,12.66-.37.65-7.26,5-7.42,5.43-.29.75,2.23,9.19.54,12.13-1.05,1.82-10.26,9.24-11.05,12.66-.71,3.03,3.09,6.8,2.15,9.47-.14.4-6.12,5.05-6.42,5.64-6.06,11.84-11.96,20.77-18.34,32.14-.32.57,1.01,3.76-.23,5.96-.26.46-9.14,4.1-9.42,5-1.93,6.31,10.53-2.27,12.9-1.75Z"/>
            <path class="st14" d="M771.03,374.82c.03,3.35.18,7.74-.25,10.96-4.43,33.16-40.39,99.67-54.72,134.03-37.42,89.73-73.44,194.96-116.3,280.61-6.47,12.93-12.75,20.28-24.03,29.42-2.36-.52-14.83,8.06-12.9,1.75.28-.9,9.16-4.54,9.42-5,1.24-2.2-.09-5.39.23-5.96,6.38-11.37,12.29-20.3,18.34-32.14.3-.58,6.28-5.24,6.42-5.64.94-2.68-2.86-6.44-2.15-9.47.8-3.42,10-10.84,11.05-12.66,1.7-2.94-.83-11.38-.54-12.13.16-.42,7.05-4.77,7.42-5.43.53-.94,1.38-12.09,1.66-12.66,1.08-2.17,5.43-3.5,6.22-4.68,5.42-8.1-5.75-10.86-5.33-14.16.19-1.47,12.43-12.52,12.26-13.41-.06-.28-4.58-2.16-4.38-3.94.04-.32,2.33-1.14,2.41-1.49,3.14-14.7,7.53-13.73,12.1-22.45.46-.89-.48-5.24.43-6.92.27-.5,4.78-3.48,5.02-3.94,1.15-2.25-.62-4.43.23-5.96.96-1.71,6.11-4.43,6.42-5.64.75-2.91-2.99-4.83-2.97-5.64.03-1.06,11.01-15,12.08-17.45.16-.37-1.29-5.76-.36-8.09.12-.29,4.9-3.64,5.02-3.94,1.74-4.42.97-10.06,4.89-17.98.28-.57-2.08-.82-1.79-1.38.45-.87,5.36-2.72,6.01-3.72,1.23-1.9,2.88-6.69,3.84-8.19.54-.85,4.43-2.23,4.81-2.98.7-1.38-1.72-8.4-.54-12.13,2-6.31,8.13-8.62,8.24-9.26.04-.2-2.55-1.85-2.38-3.51.5-4.91,5.54-4.6,6.83-7.55.24-.55.14-11.17.46-11.92.19-.44,4.23-4.92,5.63-6.81.19-.25,4.98-1.32,5.81-2.77.14-.25-2.02-5.15-1.97-5.43.06-.35,2.32-1.13,2.41-1.49.12-.52-1.15-7.21.05-10,1.31-3.05,8.46-7.05,9.03-8.09.25-.45.28-6.61.43-6.92.65-1.35,5.32-6.71,6.04-8.73.07-.2-2.76-2.19-2.38-3.51,1.43-4.95,7.46-6.92,9.44-10,1.51-2.35.81-9.77,1.25-10.75.47-1.05,7.53-8.34,8.44-10.21.42-.86-3-1.79-2.38-3.51,1.1-3.03,7.24-7.63,8.44-10.21,5.36-11.56,19.33-42.39,18.85-54.06-.06-1.54-1.59-4.35-.77-6.17-1.29-1.8-13.74-.89-16.48-1.02-18.13-.87-36.84-1.41-54.95-1.72.59-1.79.76-3.2.02-5l15.02-67.9c18.68,2.74,27.96,18.38,43.43,26.3.2,6.26,10.72,18.13,12.07,24.11.77,3.41-1.55,11.51-.28,15.96.35,1.22,3.28.54,3.79,1.81,1.19,2.97-6.05,7.59,5.86,6.76Z"/>
            <path class="st19" d="M512.16,350.57c-.28,6.38,2.31,20.2-4.5,21.07-60.22-.09-120.38,2.18-180.65.47-1.52-2.95.16-3.74,1.23-5.75,11.1-20.81,40.87-51.32,56.01-71.66.62-.83,1.55-3.08.92-4.31,27.44-.58,55.07-.12,82.53-.4l-15.07,77.9c6.79-.29,54.26,3.19,57.15,1.19,2.48-1.71-1.39-15.74,2.39-18.52Z"/>
            <path class="st0" d="M640.96,289.95c1.88,2.18,2.22,7.19,3.25,9.21,9.98,19.48,39.67,50.73,46.92,68.61.73,1.8.57,3.21-.02,5-41.58-.72-83.47-.42-125.09-.68,1.43-3.79,8.27.39,8.32-4.73l-12.71-77.33c26.46.07,52.82-.67,79.34-.08Z"/>
            <path class="st12" d="M561.62,290.03l12.71,77.33c-.05,5.12-6.89.94-8.32,4.73-17.72-.11-35.44-.3-53.15-.34-1.75,0-3.49-.11-5.2-.11,6.81-.87,4.23-14.7,4.5-21.07.88-20.24.17-40.55,1.5-60.77,15.98-.02,31.98.19,47.96.23Z"/>
            <path class="st15" d="M513.66,289.8c-1.33,20.22-.62,40.53-1.5,60.77-3.78,2.78.09,16.81-2.39,18.52-2.89,2-50.36-1.49-57.15-1.19l15.07-77.9c15.28-.15,30.68-.18,45.96-.2Z"/>
            <path class="st21" d="M771.03,374.82c-11.91.83-4.67-3.79-5.86-6.76-.51-1.27-3.44-.59-3.79-1.81-1.27-4.46,1.05-12.56.28-15.96-1.35-5.98-11.87-17.85-12.07-24.11-15.47-7.92-24.76-23.56-43.43-26.3l-15.02,67.9c-7.25-17.88-36.94-49.13-46.92-68.61-1.03-2.01-1.37-7.03-3.25-9.21,34.62.77,62.06-4.39,92.94,16.85,21.75,14.96,36.87,42.47,37.13,68.02Z"/>
            <path class="st20" d="M322.9,313.15c.48,8.56,5.69,46.82,3.54,51.83-.09.21-2.55,3.04-3.31,3.3-2.4.81-47.55.59-51.16.09-7.61-1.06-8.14-.61-8.75-7.88-2.99,2.16,1.01,5.28-1.24,8.25-2.43,3.21-6.34-.22-8.91,2.6.52-10.47,2.02-18.06,5.93-27.78,3.16,6.31,4.78-2.22,5.91-3.24,9.09-8.29,19.15-15.77,27.7-24.63,10.1,2.01,19.85-2.28,30.29-2.54Z"/>
            <path class="st6" d="M328.23,366.37l-1.79-1.38c2.15-5.01-3.06-43.27-3.54-51.83-.34-6.08.63-12.83-.11-19.05,21.42-4.4,40.34-3.24,62.37-3.7.63,1.23-.3,3.48-.92,4.31-15.14,20.34-44.91,50.86-56.01,71.66Z"/>
            <path class="st24" d="M322.8,294.1c.74,6.22-.24,12.97.11,19.05-10.44.26-20.18,4.56-30.29,2.54-8.55,8.86-18.61,16.34-27.7,24.63-1.13,1.03-2.75,9.56-5.91,3.24,11.29-28.05,34.41-43.43,63.79-49.47Z"/>
            <path class="st3" d="M517.94,836.53l-2.72,5.43c-3.2-3.84-7.16.31-8.39.21-2.7-.21-6.21-3.38-6.58-3.41-7.39-.46-15.32,4.82-20.46-4.37-50.93-149.7-123.17-290.72-187.79-435.2-2.25-5.03-8.36-13.21-9.91-17.14-.18-.45-2.44-9.16-.55-9.63l42.76.12,3.17,4.68-.47-5.11c60.27,1.71,120.43-.56,180.65-.47,1.7,0,3.45.1,5.2.11l5.09,464.78Z"/>
            <path class="st4" d="M746.05,374.49l-127.76,275.66-61.88,187.08c-2.06,6.24-36.22,7.01-37.99,4.4-1.03-1.52,1.49-4.09-.47-5.11l-5.09-464.78c17.71.03,35.44.22,53.15.34,41.62.26,83.52-.04,125.09.68,18.1.31,36.82.86,54.95,1.72Z"/>
          </g>
        </svg>
    </div>



    <span class="carot-title">Carot</span>
  </div>

  <div class="header-right">
    <div id="ble-button">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        width="17"
        height="17"
      >
        <path
          d="M12 3v18l4.5-4.5L12 12l4.5-4.5L12 3zM7 7l5 5m-5 5l5-5"
          fill="none"
          stroke="#111827"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>

    </div>
  </div>
</div>

<div id="bl-background">

<!--  sensor reading cards    -->
  <div class="metrics-grid">

    <!-- Total Exposure -->
    <div class="metric-card">
      <div class="metric-sub">
        <span>Total Exposure</span>
      </div>
      <div id="metric-total-exposure" class="metric-value">0 BLU</div>
      <div class="metric-sub">BLU</div>
    </div>

    <!-- Avg Intensity -->
    <div class="metric-card">
      <div class="metric-sub">
        <span>Avg Intensity</span>
      </div>
      <div id="metric-avg-intensity" class="metric-value">0</div>
      <div class="metric-sub">BLU</div>
    </div>

    <!-- Latest Intensity Timestamp -->
    <div class="metric-card">
      <div class="metric-sub">
        <span>Intensity</span>
      </div>
      <div id="metric-latest-time" class="metric-value">--</div>
      <div class="metric-sub">BLU</div>
    </div>

    <!-- Peak Intensity -->
    <div class="metric-card">
      <div class="metric-sub">
        <span>Peak Intensity</span>
      </div>
      <div id="metric-peak" class="metric-value">0</div>
      <div class="metric-sub">Max reading</div>
    </div>

  </div>

<!--  blue light exposure graph    -->
  <div id="bl-card">

    <div id="bl-card-title">Blue Light Exposure</div>
    <div id="bl-card-subtitle">Track your daily blue light exposure patterns</div>

    <select id="bl-select">
      <option value="today">Today</option>
      <option value="week">Week</option>
      <option value="month">Month</option>
    </select>

    <div style="height:260px; margin-top:10px;">
      <canvas id="bl_chart"></canvas>
    </div>

  </div>

  <!-- data storage cards    -->
  <div id="storage-card">
    <div class="storage-header">
      <div class="storage-title">Data Storage</div>
      <div class="storage-subtitle">Manage your locally stored blue light readings</div>
    </div>

    <div class="storage-row">
      <div class="storage-box">
        <div class="storage-label">Total Readings</div>
        <div id="storage-total" class="storage-value">0</div>
      </div>

      <div class="storage-box">
        <div class="storage-label">Storage Used</div>
        <div id="storage-size" class="storage-value">0.00 KB</div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  let blChart;
  let blMode = "today";

  function createBLChart() {
    const ctx = document.getElementById("bl_chart").getContext("2d");

    // Blue gradient fill
    const gradient = ctx.createLinearGradient(0, 0, 0, 260);
    gradient.addColorStop(0, "rgba(72, 118, 255, 0.35)");
    gradient.addColorStop(1, "rgba(72, 118, 255, 0.0)");

    blChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [{
          label: "",
          data: [],
          borderColor: "rgba(72, 118, 255, 1)",
          borderWidth: 3,
          tension: 0.35,
          fill: true,
          backgroundColor: gradient,
          pointRadius: 0,
        }]
      },
      options: {
        maintainAspectRatio: false,
        scales: {
          x: {
            ticks: {
              color: "#555",
              maxTicksLimit: 6,
            },
            grid: {
              color: "rgba(0,0,0,0.05)",
            }
          },
          y: {
            ticks: {
              color: "#555",
            },
            grid: {
              color: "rgba(0,0,0,0.05)",
            },
            beginAtZero: true
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  }

  function filterByMode(sensorLogData, mode) {
    const now = new Date();

    function inDay(r) {
      const d = new Date(r.receivedAt);
      return d.toDateString() === now.toDateString();
    }

    function inWeek(r) {
      const d = new Date(r.receivedAt);
      const monday = new Date(now);
      monday.setDate(now.getDate() - ((now.getDay() + 6) % 7));
      return d >= monday;
    }

    function inMonth(r) {
      const d = new Date(r.receivedAt);
      return d.getMonth() === now.getMonth();
    }

    let subset =
      mode === "today" ? sensorLogData.filter(inDay)
    : mode === "week"  ? sensorLogData.filter(inWeek)
    :                   sensorLogData.filter(inMonth);

    return {
      labels: subset.map(r =>
        new Date(r.receivedAt).toLocaleTimeString([], { hour: 'numeric', hour12: true })
      ),
      values: subset.map(r => r.intensity)
    };
  }

  function updateBLChart(sensorLogData) {
    window.__lastSensorLogData = sensorLogData;

    const { labels, values } = filterByMode(sensorLogData, blMode);

    blChart.data.labels = labels;
    blChart.data.datasets[0].data = values;
    blChart.update();
  }

  window.addEventListener("load", () => {
    createBLChart();

    document.getElementById("bl-select").onchange = (e) => {
      blMode = e.target.value;
      if (window.__lastSensorLogData) updateBLChart(window.__lastSensorLogData);
    };
  });

  // Receive data from React Native
  document.addEventListener("message", (event) => {
  try {
    const msg = JSON.parse(event.data);
    if (msg.type === "sensorData") {
      window.__lastSensorLogData = msg.payload;   // <--- CORRECT FIELD
      updateBLChart(msg.payload);                 // <--- CORRECT FIELD
    }
  } catch (e) {
    console.log("Message parse error", e);
  }

});

// Update Data Storage card
function updateStorageCard(stats, sensorLogData) {
    // Update total + storage size
    document.getElementById("storage-total").textContent = stats.totalReadings;
    document.getElementById("storage-size").textContent = stats.sizeKB.toFixed(2) + " KB";

    // Compute Today/Week/Month counts
    const now = new Date();

    function inDay(r) {
      const d = new Date(r.receivedAt);
      return d.toDateString() === now.toDateString();
    }

    function inWeek(r) {
      const d = new Date(r.receivedAt);
      const monday = new Date(now);
      monday.setDate(now.getDate() - ((now.getDay() + 6) % 7));
      return d >= monday;
    }

    function inMonth(r) {
      const d = new Date(r.receivedAt);
      return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
    }

    const todayCount = sensorLogData.filter(inDay).length;
    const weekCount = sensorLogData.filter(inWeek).length;
    const monthCount = sensorLogData.filter(inMonth).length;

    document.getElementById("storage-today").textContent = `${todayCount} readings`;
    document.getElementById("storage-week").textContent = `${weekCount} readings`;
    document.getElementById("storage-month").textContent = `${monthCount} readings`;
  }

  function updateMetricCards(stats) {
    document.getElementById("metric-total-exposure").textContent =
      stats.totalExposure.toFixed(1) + " BLU";

    document.getElementById("metric-avg-intensity").textContent =
      Math.round(stats.avgIntensity);

    document.getElementById("metric-peak").textContent =
      stats.maxIntensity;

    const latest = window.__lastSensorLogData?.at(-1);
    if (latest) {
      document.getElementById("metric-latest-time").textContent =
        new Date(latest.receivedAt).toLocaleTimeString([], {
          hour: 'numeric',
          minute: '2-digit'
        });
    }
  }


</script>


<script>
  // MOST RELIABLE ON iOS
  window.ReactNativeWebView = window.ReactNativeWebView || {};

  window.ReactNativeWebView.onMessage = function(event) {
  try {
    const msg = JSON.parse(event.data);

    if (msg.type === "sensorData") {
      window.__lastSensorLogData = msg.payload;
      updateBLChart(msg.payload);
    }

    if (msg.type === "storageStats") {
      updateStorageCard(msg.payload, window.__lastSensorLogData || []);
    }

  } catch (e) {
    console.log("onMessage parse error:", e);
  }
};


  // FALLBACK (Android / older RN versions)
  window.addEventListener("message", function(event) {
    try {
      const msg = JSON.parse(event.data);
      if (msg.type === "sensorData") {
        console.log("Chart received sensorData (fallback):", msg.payload);
        updateBLChart(msg.payload);
      }
    } catch (e) {
      console.log("Fallback parse error:", e);
    }
  });

</script>
  

  <script>
    (function() {
      // Initially hide the banner
      const observer = new MutationObserver(() => {
        const banner = Array.from(document.querySelectorAll('span'))
          .find(el => el.textContent.includes('Necklace connected') || el.textContent.includes('Connect'));
        if (banner) {
          banner.textContent = ''; // start blank
          banner.style.color = 'gray';
          observer.disconnect();
        }
      });
      observer.observe(document.body, { childList: true, subtree: true });

      // Listen for messages from React Native
      window.addEventListener('message', (event) => {
        try {
          const msg = JSON.parse(event.data);

          // Step 1: Web asks native to connect
          if (msg.type === 'connectBluetooth') {
            // Send trigger to native side
            window.ReactNativeWebView?.postMessage(JSON.stringify({ type: 'connectBluetooth' }));
          }

          // Step 2: Native sends connection update
          if (msg.type === 'bleConnection') {
            const connected = msg.isConnected;

            const banner = Array.from(document.querySelectorAll('span'))
              .find(el =>
                el.textContent.includes('Necklace connected') ||
                el.textContent.includes('Connect') ||
                el.textContent === ''
              );

            if (banner) {
              banner.textContent = connected ? 'Necklace Connected' : 'Disconnected';
              banner.style.color = connected ? 'green' : 'red';
            }
          }
        } catch (err) {
          console.error('BLE message parse error', err);
        }
      });
    })();
  </script>

  <script>
(function() {
  // Utility: find card by label text
  function findCardByLabel(label) {
    const elements = [...document.querySelectorAll('span, div, p, h3')];
    return elements.find(el => el.textContent.trim().toLowerCase() === label.toLowerCase());
  }

  // Update a card’s displayed numeric value
  function updateCardValue(label, value) {
    const labelEl = findCardByLabel(label);
    if (!labelEl) {
      console.warn(`Label "${label}" not found`);
      return;
    }

    // Try to find the main number within the same card
    const valueEl = labelEl.closest('div')?.parentElement?.querySelector('.text-gray-900');
    if (valueEl) {
      valueEl.textContent = value.toFixed(1);
      console.log(`Updated ${label}: ${value.toFixed(1)}`);
    } else {
      console.warn(`Value element for "${label}" not found`);
    }
  }

  // Handle messages from React Native (BLE updates)
  function handleMessage(event) {
    try {
      const data = JSON.parse(event.data);

      // update cards with sensor readings
      if (data.type === 'updateStats' && data.payload) {
        const { totalExposure, avgIntensity, maxIntensity, latestIntensity, numberReadings } = data.payload;

        
        // Update all relevant cards
        if (latestIntensity !== undefined) updateCardValue('Intensity', latestIntensity);
        if (avgIntensity !== undefined) updateCardValue('Avg Intensity', avgIntensity);
        if (maxIntensity !== undefined) updateCardValue('Peak Intensity', maxIntensity);
        if (totalExposure !== undefined) updateCardValue('Total Exposure', totalExposure);
      }
    } catch (err) {
      console.error('BLE message parse error:', err);
    }
  }

  // React Native → WebView message bridges
  document.addEventListener('message', handleMessage);
  window.addEventListener('message', handleMessage);

  console.log('BLE stat updater initialized');
})();
</script>



</body>

</html>